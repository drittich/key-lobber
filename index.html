<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="description" content="">
		<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap
			contributors">
		<meta name="generator" content="Hugo 0.84.0">
		<title>Heroes Â· Bootstrap v5.0</title>

		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
			crossorigin="anonymous">

		<link href="/docs/5.0/dist/css/bootstrap.min.css" rel="stylesheet"
			integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
			crossorigin="anonymous">

		<link rel="apple-touch-icon"
			href="/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
		<link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-32x32.png"
			sizes="32x32" type="image/png">
		<link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-16x16.png"
			sizes="16x16" type="image/png">
		<link rel="manifest" href="/docs/5.0/assets/img/favicons/manifest.json">
		<link rel="mask-icon"
			href="/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
		<link rel="icon" href="/docs/5.0/assets/img/favicons/favicon.ico">
		<meta name="theme-color" content="#7952b3">

		<style>
			.bd-placeholder-img {
				font-size: 1.125rem;
				text-anchor: middle;
				-webkit-user-select: none;
				-moz-user-select: none;
				user-select: none;
			}

			@media (min-width: 768px) {
				.bd-placeholder-img-lg {
					font-size: 3.5rem;
				}
			}

			.b-example-divider {
				height: 3rem;
				background-color: rgba(0, 0, 0, .1);
				border: solid rgba(0, 0, 0, .15);
				border-width: 1px 0;
				box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
			}
			#key {
				font-size: 96px;
				text-align: center;
				width: 200px;
				border: 1px solid black;
				margin-top: 24px;
				background-image: url('bg.png');
				background-repeat: no-repeat;
				background-size: 0% 100%;
			}	
		
			@media (min-width: 992px) {
			.rounded-lg-3 { border-radius: .3rem; }
			}

		</style>
	</head>
	<body>

		<main>

			<div class="px-4 pt-5 my-5 text-center border-bottom">
				<h1 class="display-4 fw-bold">Key Lobber</h1>
				<div class="col-lg-6 mx-auto">
					<p class="lead mb-4">Selects random musical keys at a given interval to aid
						in practicing</p>
					<div class="d-grid gap-2 d-sm-flex justify-content-sm-center mb-5">
						<select id="keyInterval" class="form-select" aria-label="Default select
							example" style="width:80px;">
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
							<option value="15">15</option>
							<option value="20">20</option>
							<option value="25">25</option>
							<option value="30">30</option>
							<option value="40">40</option>
							<option value="50">50</option>
							<option value="60">60</option>
						</select>
						<button type="button" id="start-lobbing" class="btn btn-primary btn-lg
							px-4 me-sm-3">Start
							Lobbing</button>
						<button type="button" id="stop-lobbing" class="btn btn-outline-secondary
							btn-lg px-4" disabled>Stop
							Lobbing</button>
					</div>
				</div>
				<div class="container px-5">
					<div class="position-absolute start-50 translate-middle-x" id="key">C</div>
				</div>
			</div>

		</main>

		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
			crossorigin="anonymous"></script>

		<script>
				// setup click handler for start-lobbing
				document.getElementById("start-lobbing").addEventListener("click", function() {
					// get the key interval
					var keyInterval = document.getElementById("keyInterval").value;
					// start the key lobber
					startKeyLobber(keyInterval);
				});

				//setup click handler for stop-lobbing
				document.getElementById("stop-lobbing").addEventListener("click", function() {
					// stop the key lobber
					stopKeyLobber();
				});

				//when we change the key interval, save the value to local storage
				document.getElementById("keyInterval").addEventListener("change", function() {
					// get the key interval
					var keyInterval = document.getElementById("keyInterval").value;
					// save the key interval to local storage
					localStorage.setItem("keyInterval", keyInterval);
				});

				// on page load, get the key interval from local storage and set the value
				// of the keyInterval select
				window.onload = function() {
					// get the key interval from local storage
					var keyInterval = localStorage.getItem("keyInterval");
					// if the key interval is null, set it to 10
					if (keyInterval == null) {
						keyInterval = 10;
					}
					// set the value of the keyInterval select
					document.getElementById("keyInterval").value = keyInterval;
				}

				let timer;
				function startKeyLobber(intervalSeconds) {
					getKey(intervalSeconds * 1000)
					
					// set the timer
					timer = setInterval(function() {
						getKey(intervalSeconds * 1000)
					}, intervalSeconds * 1000);
					
					// lock the UI
					document.getElementById("stop-lobbing").disabled = false;
					document.getElementById("start-lobbing").disabled = true;
					document.getElementById("keyInterval").disabled = true;
				}

				let bgTimer;
				let elapsedMs = 0;
				function getKey(intervalMs) {
					clearInterval(bgTimer);
					document.getElementById("key").innerHTML = getRandomKey();
					elapsedMs = 0;
					
					//slowly increase the background size until the next key is selected
					let frameMs = 17;
					bgTimer = setInterval(frame, frameMs);
					function frame() {
						if (elapsedMs >= intervalMs) {
							clearInterval(bgTimer);
						} else {
							elapsedMs += frameMs;
							document.getElementById("key").style.backgroundSize = Math.round((elapsedMs / intervalMs) * 100) + "% 100%";
						}
					}
				}

				function stopKeyLobber() {
					// stop the timers
					clearInterval(timer);
					clearInterval(bgTimer);
					
					//reset UI
					document.getElementById("stop-lobbing").disabled = true;
					document.getElementById("start-lobbing").disabled = false;
					document.getElementById("keyInterval").disabled = false;

					document.getElementById("key").style.backgroundSize = "0% 100%";
				}

				let currentKey = "C";
				function getRandomKey() {
					var keys = [
					"A",
					"Bb",
					"B",
					"C",
					"Db",
					"D",
					"Eb",
					"E", 
					"F",
					"Gb",
					"G",
					"Ab"];
					let nextKey = null;
					
					do {
						let randomIndex = Math.floor(Math.random() * keys.length);
						nextKey = keys[randomIndex];
					} while (nextKey == currentKey);
					currentKey = nextKey;
					return currentKey;
				}
				
			</script>
	</body>
</html>
