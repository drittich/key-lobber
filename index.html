<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Bootstrap demo</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
			crossorigin="anonymous">

		<style>
		#key {
			font-size: 96px;
			text-align: center;
			width: 200px;
			border: 1px solid black;
		}		
		#keyInterval {
			width: 100px;
		}
		</style>
	</head>
	<body>
		<div class="container">

			<h1>Key Lobber</h1>

			<form>
				<div class="mb-3">
					<label for="keyInterval" class="form-label">Seconds between keys</label>
					<input type="text" class="form-control" id="keyInterval"
						aria-describedby="keyIntervalHelp" value="30">
					<div id="keyIntervalHelp" class="form-text">Enter the number of seconds
						before a new random key is selected</div>
				</div>

				<button type="button" id="start-lobbing" class="btn btn-primary">Start
					Lobbing</button>
				<button type="button" id="stop-lobbing" class="btn btn-primary">Stop Lobbing</button>
			</form>

			<div id="key">C</div>
		</div>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
			crossorigin="anonymous"></script>

		<script>
				// setup click handler for start-lobbing
				document.getElementById("start-lobbing").addEventListener("click", function() {
					// get the key interval
					var keyInterval = document.getElementById("keyInterval").value;
					// start the key lobber
					startKeyLobber(keyInterval);
				});

				//setup click handler for stop-lobbing
				document.getElementById("stop-lobbing").addEventListener("click", function() {
					// stop the key lobber
					stopKeyLobber();
				});

				let interval;
				function startKeyLobber(intervalSeconds) {
					// set the interval
					interval = setInterval(function() {
						// get a random key
						var key = getRandomKey();
						// set the key
						document.getElementById("key").innerHTML = key;
					}, intervalSeconds * 1000);
					// enable the stop button	
					document.getElementById("stop-lobbing").disabled = false;
				}

				function stopKeyLobber() {
					// stop the interval
					clearInterval(interval);
					//disable the stop button
					document.getElementById("stop-lobbing").disabled = true;
				}

				let currentKey = "C";
				function getRandomKey() {
					var keys = [
					"A",
					"Bb",
					"B",
					"C",
					"Db",
					"D",
					"Eb",
					"E", 
					"F",
					"Gb",
					"G",
					"Ab"];
					let nextKey = null;
					
					do {
						let randomIndex = Math.floor(Math.random() * keys.length);
						nextKey = keys[randomIndex];
					} while (nextKey == currentKey);
					currentKey = nextKey;
					return currentKey;
				}
				
			</script>
	</body>
</html>